# Zemax OpticStudio LDE 变量设置功能测试计划

## 测试步骤

### 第一步：检查 Even Asphere 文件结构

1. 运行 `check_even_asphere.py` 脚本，确认文件存在并可以正确加载
   ```
   python examples/check_even_asphere.py
   ```

2. 查看输出，记录以下信息：
   - 表面总数
   - 非球面表面的编号
   - 非球面表面的参数（曲率半径、锥面系数、非球面系数）

### 第二步：测试变量设置功能

1. 运行 `even_asphere_variables_test.py` 脚本
   ```
   python examples/even_asphere_variables_test.py
   ```

2. 检查脚本执行过程中的输出：
   - 表面类型识别是否正确
   - 单个变量设置是否成功
   - 批量变量设置是否成功
   - 变量设置的验证结果

3. 查看保存的镜头文件：
   - 打开 Zemax OpticStudio 查看 `output/even_asphere_variables_test.zos`
   - 确认变量设置是否已正确应用（有变量符号 V）
   - 确认变量范围是否符合预期

### 第三步：修复可能的问题

如果发现问题，可以调整以下内容：

1. **非球面表面识别问题**：
   - 修改 `zosapi_lde.py` 中的 `set_all_aspheric_as_variables` 方法，改进表面类型识别逻辑
   - 尝试直接使用单元格方式访问参数，不依赖于表面类型判断

2. **变量设置不生效问题**：
   - 确保在设置变量前单元格已有有效值
   - 使用 `MakeSolveVariable()` 方法和 `SetSolveData()` 方法的组合
   - 可能需要手动更新表面或系统状态

3. **脚本报错问题**：
   - 增加更多的异常处理
   - 尝试不同的方法设置变量（直接设置或通过单元格操作）

## 预期结果

1. 能够正确识别 Even Asphere 文件中的非球面表面
2. 能够设置曲率半径、锥面系数和非球面系数为优化变量
3. 批量设置变量功能正常工作
4. 保存的文件中变量设置已正确应用

## 注意事项

- 确保有足够的异常处理，避免脚本崩溃
- 记录执行日志，帮助识别问题
- 如有必要，可以先尝试单个表面和单个参数的设置，再扩展到批量操作
- 每次调整后重新测试，确保问题已解决
